<?php
include 'connect.php';
?>


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- CSS only -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link href="Bootstrap/css/bootstrap.min.css">
    <script src="Bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- JavaScript Bundle with Popper -->

    <title>Receivables</title>
</head>

<body>
    <div class="container mt-3">
        <h1 class="text-center">Receivables</h1>
        <table id="tbl" style="color:white;" class="table table-responsive table-striped table-bordered mt-5 p-3 zero-configuration">
            <thead style="background-color: rgb(79,129,189);">
                <tr>
                    <th>Sr. No.</th>
                    <th>Firm Name</th>
                    <th>Bill No.</th>
                    <th>Date</th>
                    <th>Party</th>
                    <th>Amount</th>
                    <th>Amount Received</th>
                    <th>Receipt Date</th>
                    <th>Mode</th>
                    <th>Chq. No.</th>
                    <th>Amount Pending</th>
                    <th>TDS</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>

                <?php
                $query = "select * from bill_master";
                $result = mysqli_query($con, $query);
                if ($result->num_rows > 0) {
                    $row_count = 0;
                    while ($row = mysqli_fetch_assoc($result)) {
                        $row_count += 1;
                ?>

                        <tr>
                            <td class="text-center"><?php echo $row_count; ?></td>
                            <td class="text-left"><?php echo $row['firm']; ?></td>
                            <td class="text-left"><?php echo $row['invoice_no'] ?></td>
                            <td class="text-right"><?php echo $row['date']; ?></td>
                            <td class="text-left"><?php echo $row['party']; ?></td>
                            <td class="text-right"><input type="number" value="<?php echo $row['amount_']; ?>"></td>
                            <td>
                                <div style="width:60%;">
                                    <?php
                                    if ($row['amount_received'] == 0) {
                                    ?>
                                        <select id="<?php echo $row_count; ?>" class="custom-select" disabled>
                                            <option value="0" selected class="text-danger">No</option>
                                            <option value="1" class="text-success">Yes</option>
                                        </select>
                                    <?php
                                    } else {
                                    ?>
                                        <span class="text-success">Yes</span>
                                    <?php
                                    }
                                    ?>
                                </div>
                            </td>
                            <td class="text-right"><input type="text" id="<?php echo $row_count . 'rDate'; ?>" value="<?php echo $row['reciept_date']; ?>"></td>
                            <td class="text-left"><input type="text" id="<?php echo $row_count . 'mode'; ?>" value="<?php echo $row['mode']; ?>"></td>
                            <td class="text-left"><input type="text" id="<?php echo $row_count . 'chq'; ?>" value="<?php echo $row['cheque_no']; ?>"></td>
                            <td class="text-right"><input type="text" id="<?php echo $row_count . 'pending'; ?>" value="<?php echo $row['amount_pending']; ?><">/td>
                            <td class="text-left"><input type="text" id="<?php echo $row_count . 'tds'; ?>" value="<?php echo $row['tds']; ?>"></td>
                            <td>
                                <div style="display:inline-block; padding:20%;">
                                    <button style="float:left;" id="<?php echo $row_count . 'edit' ?>" onClick="handleEdit('<?php echo $row_count; ?>','Edit')" class="btn btn-primary mb-2">
                                        <span>&#10000;</span>
                                    </button>
                                    <button style="float:left; display:none;" id="<?php echo $row_count . 'save' ?>" onClick="handleEdit('<?php echo $row_count; ?>','Save')" class="btn btn-success m-2">
                                        <span>&#10004;</span>
                                    </button>
                                    <button style="float:right;" id="<?php echo $row_count; ?>" onClick="handleCancel('<?php echo $row_count; ?>')" class="btn btn-danger mt-2">
                                        <span id="cancel">&#10008;</span>
                                    </button>
                                </div>
                            </td>
                        </tr>

                <?php
                    }
                }
                ?>
            </tbody>
        </table>
    </div>


    <script>
        function handleEdit(id, action) {

            if (action == 'Edit') {
                if ($('#amount_received' + id).val() == 0) {
                    document.getElementById(id + 'edit').style.display = 'none';
                    document.getElementById(id + 'save').style.display = 'block';
                    $("#" + id + 'rDate').prop('disabled', false);
                    $("#" + id + 'mode').prop('disabled', false);
                    $("#" + id + 'chq').prop('disabled', false);
                    $("#" + id + 'pending').prop('disabled', false);
                    $("#" + id + 'tds').prop('disabled', false);
                } else {
                    alert("Payment Done..Cannot Edit");
                }


            } else {
                handleCancel(id);
                $.ajax({
                    type: "POST",
                    url: "updateReceivables.php",
                    data: "id=" + id,
                    success: function(data) {
                        alert(data);
                        location.reload();
                    }
                });
            }

        }

        function handleCancel(id) {
            document.getElementById(id + 'edit').style.display = 'block';
            document.getElementById(id + 'save').style.display = 'none';
            $("#" + id + 'rDate').prop('disabled', true);
            $("#" + id + 'mode').prop('disabled', true);
            $("#" + id + 'chq').prop('disabled', true);
            $("#" + id + 'pending').prop('disabled', true);
            $("#" + id + 'tds').prop('disabled', true);


            document.cookie = "qty=" + $('#qty' + id).val();
            document.cookie = "fc=" + $('#fc' + id).val();
            document.cookie = "cc=" + $('#cc' + id).val();
            document.cookie = "rate=" + $('#rate' + id).val();
            document.cookie = "payment=" + $('#payment' + id).val();

        }
    </script>

</body>

</html>